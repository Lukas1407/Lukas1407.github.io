<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: ;
            min-height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f9f9f9;
        }
        .container {
            width: 90%;
            max-width: 600px;
        }
        .slider {
            margin: 20px 0;
        }
        svg {
            width: 100%;
            height: auto;
        }
        .result {
            font-size: 1.5em;
            margin-top: 10px;
            color: #333;
        }
        .correct-message {
            font-size: 1.2em;
            color: green;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Wie gut ist Linus im Fußball?</h2>
    <div id="plot"></div>
    <div class="slider">
        <label for="aSlider">Linus Fußball Skill Level:</label>
        <input type="range" id="aSlider" min="0.1" max="20" step="0.1" value="0.1">
        <div class="result" id="aValueDisplay">1</div>
        <div class="correct-message" id="correctMessage" style="display: none;">Richtig! Linus ist der aller Beste &#128150;</div>
    </div>
</div>

<script>
    // Define the plot dimensions based on container width
    const width = 500;
    const height = 400;
    const margin = { top: 20, right: 20, bottom: 50, left: 50 };
    
    // Define scales for x and y
    const xScale = d3.scaleLinear().domain([-2, 2]).range([margin.left, width - margin.right]);
    const yScale = d3.scaleLinear().domain([-1.5, 2.5]).range([height - margin.bottom, margin.top]);

    // Append the SVG canvas for plotting
    const svg = d3.select("#plot").append("svg")
        .attr("viewBox", `0 0 ${width} ${height}`)
        .attr("preserveAspectRatio", "xMidYMid meet");

    // Define the x and y axes
    const xAxis = d3.axisBottom(xScale);
    const yAxis = d3.axisLeft(yScale);

    svg.append("g")
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(xAxis);

    svg.append("g")
        .attr("transform", `translate(${margin.left},0)`)
        .call(yAxis);

    // Initial value for parameter 'a'
    let a = 0.1;

    // Function definition
    function f(x, a) {
        const xAbs = Math.abs(x);
        return Math.pow(xAbs, 2/3) + (Math.E / 3) * Math.sqrt(Math.PI - xAbs**2) * Math.sin(a * Math.PI * xAbs);
    }

    // Generate and plot data for function
    function plotFunction() {
        const data = d3.range(-2, 2.01, 0.01).map(x => ({ x, y: Math.abs(x) <= Math.sqrt(Math.PI) ? f(x, a) : NaN }));
        
        const line = d3.line()
            .defined(d => !isNaN(d.y))
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));

        svg.selectAll(".line").remove();  // Clear previous lines

        svg.append("path")
            .datum(data)
            .attr("class", "line")
            .attr("fill", "none")
            .attr("stroke", "red")
            .attr("stroke-width", 2)
            .attr("d", line);
    }

    // Initial plot
    plotFunction();

    // Update function when slider is changed
    d3.select("#aSlider").on("input", function() {
        a = +this.value;

        // Calculate and display the adjusted value from 1 to 99
        const displayValue = Math.round(((a - 0.1) / (20 - 0.1)) * 98) + 1;
        d3.select("#aValueDisplay").text(displayValue);

        // Show "Correct" message if slider hits the max, hide otherwise
        const isMaxValue = a === 20;
        d3.select("#correctMessage").style("display", isMaxValue ? "block" : "none");

        plotFunction();
    });
</script>

</body>
</html>
